<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="generator" content="Publish.jl" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="keywords" content="" />
    <title>DataLoaders.jl</title>
    <link rel="stylesheet" href="..&#x2F;normalize.css" />
    <link rel="stylesheet" href="..&#x2F;tabulator_simple.min.css" />
    <link rel="stylesheet" href="..&#x2F;publish.css" />
    <link rel="stylesheet" href="..&#x2F;default.min.css" />
    <script src="..&#x2F;versions.js"></script>
    <script src="..&#x2F;lunr.js"></script>
    <script src="..&#x2F;highlight.min.js"></script>
    <script src="..&#x2F;tabulator.min.js"></script>
    <script src="..&#x2F;julia.min.js"></script>
    <script src="..&#x2F;julia-repl.min.js"></script>
    <script src="..&#x2F;publish.js"></script>
    <link rel="stylesheet" href="custom.css" />
    
</head>
<body>
    <div class="menu">
        <svg id="menu-toggler" title="Contents" onclick="toggleIndexPage();" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor" /><path d="M2 12.0322C2 11.4799 2.44772 11.0322 3 11.0322H21C21.5523 11.0322 22 11.4799 22 12.0322C22 12.5845 21.5523 13.0322 21 13.0322H3C2.44772 13.0322 2 12.5845 2 12.0322Z" fill="currentColor" /><path d="M3 17.0645C2.44772 17.0645 2 17.5122 2 18.0645C2 18.6167 2.44772 19.0645 3 19.0645H21C21.5523 19.0645 22 18.6167 22 18.0645C22 17.5122 21.5523 17.0645 21 17.0645H3Z" fill="currentColor" /></svg>
        <input id="search-input" placeholder="Search">
        <select id="version-selector"></select>
    </div>
    <main id="page"><article><h1 id="data-containers"><a href="#data-containers" class="anchor"></a>Data containers</h1>
<p class="subtitle">Introduction to data containers giving an overview over the kinds of datasets you can use</p>
<p>DataLoaders.jl is built to integrate with the further ecosystem and builds on a common interface to support datasets. We call such a dataset a <strong>data container</strong> and it needs to support the following operations:</p>
<ul>
<li><code>getobs(data, i)</code> loads the <code>i</code>-th observation from a dataset</li>
<li><code>nobs(data)</code> gives the number of observations in a dataset.</li>
</ul>
<h2 id="basic-data-containers"><a href="#basic-data-containers" class="anchor"></a>Basic data containers</h2>
<p>The simplest data container is a vector of values:</p>
<pre><code cell="main" class="language-julia">using DataLoaders
@show v = rand(1:10, 10)
@show nobs(v)
getobs(v, 1)
</code></pre>
<pre><code class="plaintext cell-output cell-stream">v = rand(1:10, 10) = [3, 6, 3, 3, 8, 10, 7, 5, 8, 5]
nobs(v) = 10
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">3</code></pre>
<p>Multi-dimensional arrays also work, with the last dimension treated as the observation dimension:</p>
<pre><code cell="main" class="language-julia">a = rand(50, 50, 10)
summary(getobs(a, 1))
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">&quot;50×50 Array{Float64,2}&quot;</code></pre>
<p>You can also group multiple data containers with the same length together by putting them into a <code>Tuple</code>:</p>
<pre><code cell="main" class="language-julia">data = (v, a)
getobs(data, 1)
</code></pre>
<pre><code class="plaintext cell-output cell-result" class="language-plaintext">(3, [0.8148535039819387 0.7922262999563554 … 0.336305525839971 0.39967133160729174; 0.22876049704979984 0.7795581030006868 … 0.03312495332714205 0.505938500562874; … ; 0.7762865670368284 0.3023074921420861 … 0.054573146229005554 0.5027648033765222; 0.6123445851503997 0.8449596180305357 … 0.08861311036859099 0.261189721176907])</code></pre>
<p>You can pass any data container to <a href="../docstrings/DataLoaders.DataLoader.html"><code>DataLoader</code></a> to create an iterator over batches:</p>
<pre><code class="language-julia">for batch in DataLoader(v, 2)
    @assert size(batch) == (2,)
end

for batch in DataLoader(a, 2) 
    @assert size(batch) == (50, 50, 2)
end

for (vs, as) in DataLoader((v, a), 2) 
    @assert size(vs) == (2,)
    @assert size(as) == (50, 50, 2)
end

</code></pre>
<h2 id="out-of-memory-data-containers"><a href="#out-of-memory-data-containers" class="anchor"></a>Out-of-memory data containers</h2>
<p>Arrays, of course, are kept in memory, so we (1) cannot use them to store larger-than-memory datasets (2) don’t need to use multithreading since loading an observation just involves indexing an array which is generally fast.</p>
<p>One way to quickly get into the territory of too-large-to-fit in memory is to work with image datasets. So instead of loading every image of a dataset into an array, we’ll implement a data container that stores only the file names of each image. It will load the image itself only when <code>getobs</code> is called. To do that we’ll implement a <code>struct</code> that stores a vector of file names, and implement <code>getobs</code> and <code>nobs</code> for that type.</p>
<pre><code class="language-julia">import DataLoaders.LearnBase: getobs, nobs
using Images

struct ImageDataset
    files::Vector{String}
end
ImageDataset(folder::String) = ImageDataset(readdir(folder))

nobs(data::ImageDataset) = length(data.files)
getobs(data::ImageDataset, i::Int) = Images.load(data.files[i])
</code></pre>
<p>Now, if we have a folder full of images, we can create a data container and load them quickly into batches as follows:</p>
<pre><code class="language-julia">data = ImageDataset(&quot;path/to/my/images&quot;)
for images in DataLoader(data, 16, collate = false)
    # Do something
end
</code></pre>
<div class="admonition note"><p class="admonition-title">Preprocessing</p>
<p>Above we pass the <code>collate = false</code> argument because images may be of different sizes that cannot be collated. See <a href="../docstrings/DataLoaders.collate.html"><code>collate</code></a>. In practice, it is common to apply some cropping and resizing to images so that they all have the same size.</p>
</div><div class="admonition warning"><p class="admonition-title">Threads</p>
<p>To use <code>DataLoaders</code>’ multi-threading, you need to start Julia with multiple
threads. Check the number of available threads with <code>Threads.nthreads()</code>.</p>
</div></article>
        <div id="page-navigation">
            <a id="previous-page" title="Previous" href="setup.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M16.2426 6.34317L14.8284 4.92896L7.75739 12L14.8285 19.0711L16.2427 17.6569L10.5858 12L16.2426 6.34317Z" fill="currentColor" /></svg></a>
            <a id="next-page" title="Next" href="shuffling.html"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M10.5858 6.34317L12 4.92896L19.0711 12L12 19.0711L10.5858 17.6569L16.2427 12L10.5858 6.34317Z" fill="currentColor" /></svg></a>
        </div>
    </main>
    <nav id="toc"><ul>
<li><a href="../README.html">Introduction</a></li>
<li><a href="../docs/overview.html">Overview</a></li>
<li><a href="../docs/setup.html">Installation</a></li>
<li><a href="../docs/datacontainers.html">Data containers</a></li>
<li><a href="../docs/shuffling.html">Shuffling, subsetting, splitting</a></li>
<li><a href="../docs/collate.html">Collating</a></li>
<li><a href="../docs/inplaceloading.html">Inplace loading</a></li>
<li><a href="../docs/interface.html">Data container interface</a></li>
<li><a href="../docs/ecosystem.html">Ecosystem</a></li>
<li><a href="../docs/quickstartpytorch.html">Comparison to PyTorch</a></li>
<li><a href="../docs/status.html">TODOs</a></li>
</ul>
</nav>
    <footer>
        Built with <a target="_blank" href="https://github.com/MichaelHatherly/Publish.jl">Publish.jl</a> and the <a target="_blank" href="https://julialang.org">Julia Language.</a>
    </footer>
    <script>hljs.initHighlightingOnLoad();</script>
</body>
</html>
